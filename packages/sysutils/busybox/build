#!/bin/sh

. config/options $1

if [ -f $PROJECT_DIR/$PROJECT/busybox/$1.conf ]; then
  BUSYBOX_CFG_FILE=$PROJECT_DIR/$PROJECT/busybox/$1.conf
else
  BUSYBOX_CFG_FILE=$ROOT/$PKG_DIR/config/$1.conf
fi

cd $BUILD/busybox*

# Build Busybox for system
  make distclean
  cp $BUSYBOX_CFG_FILE .config
  [ -n "$TIMEZONE" ] && sed -i -e 's/^# CONFIG_HWCLOCK .*$/CONFIG_HWCLOCK=yes/g' -e 's/^# CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS .*/CONFIG_FEATURE_HWCLOCK_LONG_OPTIONS=yes/g' $BUSYBOX/.config
  make oldconfig

  make HOSTCC="$HOST_CC" \
       ARCH=$TARGET_ARCH \
       CROSS_COMPILE="$TARGET_PREFIX" \
       EXTRA_CFLAGS="$CFLAGS" \
       V=1 install
